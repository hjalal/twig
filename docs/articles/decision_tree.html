<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Decision Tree Herpes Virus Encephalopathy • twig</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Decision Tree Herpes Virus Encephalopathy">
<meta property="og:description" content="twig">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">twig</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/decision_tree.html">Decision Tree Herpes Virus Encephalopathy</a>
    </li>
    <li>
      <a href="../articles/markov_time_dep.html">A Tutorial for Time Dependent Markov Model</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://www.dashlab.ca/projects/decision_twig/" class="external-link">DecisionTwig</a>
</li>
<li>
  <a href="https://github.com/hjalal/twig" class="external-link">GitHub</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hjalal/twig" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Decision Tree Herpes Virus Encephalopathy</h1>
            
      
      
      <div class="hidden name"><code>decision_tree.Rmd</code></div>

    </div>

    
    
<p>This is an example that we use to illustrate decision trees in our
DARTH teaching materials. The example involves the treatment of herpes
simplex ecncephalopathy (HVE) by either treating everyone without biopsy
(Treat), not treating or taking biopsy (DoNotTreat), and Taking biopsy
and treat if biopsy posivite (Biopsy).</p>
<p>We will first define the twig model and the parameters and then we
will show how one would code the model direclty in R and compare the
outcomes.</p>
<div class="section level2">
<h2 id="twig">twig<a class="anchor" aria-label="anchor" href="#twig"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">200</span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">twig</span><span class="op">)</span></span></code></pre></div>
<p>twig model definition</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mytwig</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/twig.html">twig</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/decisions.html">decisions</a></span><span class="op">(</span>names<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">DoNotTreat</span>, <span class="va">Treat</span>, <span class="va">Biopsy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># treatment options</span></span>
<span>  <span class="fu"><a href="../reference/event.html">event</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">DIE</span>,  <span class="co"># first event</span></span>
<span>        options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">yes</span>, <span class="va">none</span><span class="op">)</span>, <span class="co"># either occurs or doesn't occur</span></span>
<span>        probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pDie</span>, <span class="va">leftover</span><span class="op">)</span>,  <span class="co"># occurs with prob pDie and doesn't occur with 1-pDie (leftover)</span></span>
<span>        transitions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Death</span>, <span class="va">HVE_event</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># if it occurs, transitions to Death, otherwise the HVE_event</span></span>
<span>  <span class="fu"><a href="../reference/event.html">event</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">HVE_event</span>,  <span class="co"># similarly, HVE_event occurs with f_HVE but if not it will be OVE</span></span>
<span>        options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">yes</span>, <span class="va">none</span><span class="op">)</span>, </span>
<span>        probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">f_HVE</span>, <span class="va">leftover</span><span class="op">)</span>, </span>
<span>        transitions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">get_HVE_comp</span>, <span class="va">get_OVE_comp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/event.html">event</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">get_HVE_comp</span>, <span class="co"># evaluate whether HVE complications occured </span></span>
<span>        options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">yes</span>, <span class="va">none</span><span class="op">)</span>, </span>
<span>        probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">p_comp</span>, <span class="va">leftover</span><span class="op">)</span>,</span>
<span>        transitions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">HVE_comp</span>, <span class="va">no_HVE_comp</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/event.html">event</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">get_OVE_comp</span>, <span class="co"># evaluate whether other viral encephalitis (OVE) complications occured</span></span>
<span>        options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">yes</span>, <span class="va">none</span><span class="op">)</span>, </span>
<span>        probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">p_comp</span>, <span class="va">leftover</span><span class="op">)</span>,</span>
<span>        transitions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">OVE_comp</span>, <span class="va">no_OVE_comp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/payoffs.html">payoffs</a></span><span class="op">(</span>names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cost</span>, <span class="va">utility</span><span class="op">)</span><span class="op">)</span> <span class="co"># finally measure the cost and utilities </span></span></code></pre></div>
<p>In <a href="https://www.dashlab.ca/projects/decision_twig/" class="external-link">DecisionTwig</a>,
this decision tree looks like this: <img src="../reference/figures/decision_tree_twig.png" width="700" alt="DecisionTree"> ## Model parameters Define a data frame for model
parameters as a list of scalar values. This can also ve a dataset for
running a probabilistic analysis.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="co"># Probabilities,</span></span>
<span>  p_HVE          <span class="op">=</span> <span class="fl">0.52</span>   ,<span class="co"># prevalence of HVE</span></span>
<span>  p_HVE_comp     <span class="op">=</span> <span class="fl">0.71</span>   ,<span class="co"># complications with untreated HVE</span></span>
<span>  p_OVE_comp     <span class="op">=</span> <span class="fl">0.01</span>   ,<span class="co"># complications with untreated OVE</span></span>
<span>  p_HVE_comp_tx  <span class="op">=</span> <span class="fl">0.36</span>   ,<span class="co"># complications with treated HVE</span></span>
<span>  p_OVE_comp_tx  <span class="op">=</span> <span class="fl">0.20</span>   ,<span class="co"># complications with treated OVE</span></span>
<span>  p_biopsy_death <span class="op">=</span> <span class="fl">0.005</span>  ,<span class="co"># probability of death due to biopsy</span></span>
<span>  </span>
<span>  <span class="co"># Costs,</span></span>
<span>  c_VE           <span class="op">=</span> <span class="fl">1200</span>   ,<span class="co"># cost of viral encephalitis care without complications</span></span>
<span>  c_VE_comp      <span class="op">=</span> <span class="fl">9000</span>   ,<span class="co"># cost of viral encephalitis care with complications</span></span>
<span>  c_tx           <span class="op">=</span> <span class="fl">9500</span>   ,<span class="co"># cost of treatment</span></span>
<span>  c_biopsy       <span class="op">=</span> <span class="fl">25000</span>  ,<span class="co"># cost of brain biopsy</span></span>
<span>  </span>
<span>  <span class="co"># QALYs,</span></span>
<span>  q_VE           <span class="op">=</span> <span class="fl">20</span>     ,<span class="co"># remaining QALYs for those without VE-related complications</span></span>
<span>  q_VE_comp      <span class="op">=</span> <span class="fl">19</span>     ,<span class="co"># remaining QALYs for those with VE-related complications</span></span>
<span>  q_loss_biopsy  <span class="op">=</span> <span class="fl">0.01</span>   ,<span class="co"># one-time QALY loss due to brain biopsy</span></span>
<span>  q_death_biopsy <span class="op">=</span> <span class="fl">0</span>      <span class="co"># remaining QALYs for those who died during biopsy</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a>
</h3>
<div class="section level4">
<h4 id="probability-of-death">Probability of death<a class="anchor" aria-label="anchor" href="#probability-of-death"></a>
</h4>
<p>We only look into death from biopsy in this decision tree.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pDie</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">decision</span>, <span class="va">p_biopsy_death</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">p_biopsy_death</span> <span class="op">*</span> <span class="op">(</span><span class="va">decision</span> <span class="op">==</span> <span class="st">"Biopsy"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="probability-of-complications">Probability of complications<a class="anchor" aria-label="anchor" href="#probability-of-complications"></a>
</h4>
<p>This depends on whether treatment received or not, HVE vs. OVE, and
whether either HVE or OVE complications occured.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_comp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">decision</span>, <span class="va">HVE_event</span>, <span class="va">p_HVE_comp</span>, <span class="va">p_OVE_comp</span>, </span>
<span>                   <span class="va">p_HVE_comp_tx</span>, <span class="va">p_OVE_comp_tx</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="co"># complication of untreated HVE</span></span>
<span>    <span class="va">p_HVE_comp</span> <span class="op">*</span> <span class="op">(</span><span class="va">decision</span> <span class="op">==</span> <span class="st">"DoNotTreat"</span> <span class="op">&amp;</span> <span class="va">HVE_event</span><span class="op">==</span><span class="st">"yes"</span><span class="op">)</span> <span class="op">+</span> </span>
<span></span>
<span>    <span class="co"># complication of untreated OVE</span></span>
<span>    <span class="va">p_OVE_comp</span> <span class="op">*</span> <span class="op">(</span><span class="va">decision</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DoNotTreat"</span>, <span class="st">"Biopsy"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">HVE_event</span><span class="op">==</span><span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> </span>
<span></span>
<span>    <span class="co"># complications of treated HVE</span></span>
<span>    <span class="va">p_HVE_comp_tx</span> <span class="op">*</span> <span class="op">(</span><span class="va">decision</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Treat"</span>, <span class="st">"Biopsy"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">HVE_event</span><span class="op">==</span><span class="st">"yes"</span><span class="op">)</span> <span class="op">+</span> </span>
<span></span>
<span>    <span class="co"># complications of treated OVE</span></span>
<span>    <span class="va">p_OVE_comp_tx</span> <span class="op">*</span> <span class="op">(</span><span class="va">decision</span> <span class="op">==</span> <span class="st">"Treat"</span> <span class="op">&amp;</span> <span class="va">HVE_event</span><span class="op">==</span><span class="st">"none"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="probability-of-hve">Probability of HVE<a class="anchor" aria-label="anchor" href="#probability-of-hve"></a>
</h4>
<p>All event probabilities must be function names. So, we can just
create a simple wrapper around the p_HVE variable.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f_HVE</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p_HVE</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">p_HVE</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="cost-function">Cost function<a class="anchor" aria-label="anchor" href="#cost-function"></a>
</h4>
<p>Cost is a function of the decision and the final model outcomes.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cost</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">decision</span>, <span class="va">outcome</span>, <span class="va">c_biopsy</span>, <span class="va">c_tx</span>, <span class="va">c_VE_comp</span>, <span class="va">c_VE</span><span class="op">)</span><span class="op">{</span> </span>
<span></span>
<span>  <span class="co"># cost of biopsy</span></span>
<span>  <span class="va">c_biopsy</span><span class="op">*</span><span class="op">(</span><span class="va">decision</span><span class="op">==</span><span class="st">"Biopsy"</span><span class="op">)</span> <span class="op">+</span> </span>
<span></span>
<span>    <span class="co"># cost of treatment if treated or biopsy was +ve for HVE</span></span>
<span>    <span class="va">c_tx</span><span class="op">*</span><span class="op">(</span><span class="va">decision</span><span class="op">==</span><span class="st">"Treat"</span> <span class="op">|</span> <span class="op">(</span><span class="va">decision</span><span class="op">==</span><span class="st">"Biopsy"</span> <span class="op">&amp;</span> <span class="va">outcome</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HVE_comp"</span>, <span class="st">"no_HVE_comp"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span></span>
<span>    <span class="co"># cost of complication if outcomes are in either HVE or OVE complications</span></span>
<span>    <span class="va">c_VE_comp</span><span class="op">*</span><span class="op">(</span><span class="va">outcome</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HVE_comp"</span>, <span class="st">"OVE_comp"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span></span>
<span>    <span class="co"># cost of viral encephalitis if complications didn't occur</span></span>
<span>    <span class="va">c_VE</span><span class="op">*</span><span class="op">(</span><span class="va">outcome</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"no_HVE_comp"</span>, <span class="st">"no_OVE_comp"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="utility">utility<a class="anchor" aria-label="anchor" href="#utility"></a>
</h4>
<p>Is a function of the decision and final outcome.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">utility</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">decision</span>, <span class="va">outcome</span>, <span class="va">q_loss_biopsy</span>, <span class="va">q_VE_comp</span>, <span class="va">q_VE</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="co"># apply utility discount for biopsy</span></span>
<span>  <span class="op">-</span><span class="va">q_loss_biopsy</span><span class="op">*</span><span class="op">(</span><span class="va">decision</span><span class="op">==</span><span class="st">"Biopsy"</span><span class="op">)</span> <span class="op">+</span> </span>
<span></span>
<span>  <span class="co"># apply utility values for complications</span></span>
<span>    <span class="va">q_VE_comp</span><span class="op">*</span><span class="op">(</span><span class="va">outcome</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HVE_comp"</span>, <span class="st">"OVE_comp"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span></span>
<span>    <span class="co"># apply utility values if complications didn't occur</span></span>
<span>    <span class="va">q_VE</span><span class="op">*</span><span class="op">(</span><span class="va">outcome</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"no_HVE_comp"</span>, <span class="st">"no_OVE_comp"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="running-the-twig">Running the <code>twig</code><a class="anchor" aria-label="anchor" href="#running-the-twig"></a>
</h2>
<p>We can run the model and check the results of the single parameter
set under <code>results$Rewards_sim</code></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_twig.html">run_twig</a></span><span class="op">(</span>twig_obj <span class="op">=</span> <span class="va">mytwig</span>, params <span class="op">=</span> <span class="va">params</span>, parallel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Checking Twig syntax ....</span></span>
<span><span class="co">#&gt; A states layer was not detected. Event transitions include the following event names:  HVE_event, get_HVE_comp, get_OVE_comp . These are valid. </span></span>
<span><span class="co">#&gt; The following transitions are not event names and will be treated as final outcomes:  Death, HVE_comp, no_HVE_comp, OVE_comp, no_OVE_comp .</span></span>
<span><span class="co">#&gt; Twig syntax validation completed successfully.</span></span>
<span><span class="co">#&gt; Preprocessing started ...</span></span>
<span><span class="co">#&gt; Preprocessing completed. Starting simulation...</span></span>
<span><span class="co">#&gt;   |                                                                                                                                                                                                      |                                                                                                                                                                                              |   0%  |                                                                                                                                                                                                      |==============================================================================================================================================================================================| 100%</span></span>
<span><span class="co">#&gt; Total time: 0.00081 secs</span></span>
<span></span>
<span><span class="va">results</span><span class="op">$</span><span class="va">Rewards_sim</span></span>
<span><span class="co">#&gt; , , sim = 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             reward</span></span>
<span><span class="co">#&gt; decision         cost  utility</span></span>
<span><span class="co">#&gt;   DoNotTreat  4117.20 19.62600</span></span>
<span><span class="co">#&gt;   Treat      12908.96 19.71680</span></span>
<span><span class="co">#&gt;   Biopsy     32599.41 19.69896</span></span></code></pre></div>
<div class="section level3">
<h3 id="incremental-cost-effectiveness-ratio-icer">Incremental Cost-Effectiveness Ratio (ICER)<a class="anchor" aria-label="anchor" href="#incremental-cost-effectiveness-ratio-icer"></a>
</h3>
<p>using the <code>calculate_icers</code> function adapted from the
dampack package, we can retrieve ICER table by passing the rewards
summary table.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/calculate_icers.html">calculate_icers</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Rewards_summary</span><span class="op">)</span></span>
<span><span class="co">#&gt;              decision     cost  utility inc_cost inc_utility     ICER status</span></span>
<span><span class="co">#&gt; DoNotTreat DoNotTreat  4117.20 19.62600       NA          NA       NA     ND</span></span>
<span><span class="co">#&gt; Treat           Treat 12908.96 19.71680  8791.76      0.0908 96825.55     ND</span></span>
<span><span class="co">#&gt; Biopsy         Biopsy 32599.41 19.69896       NA          NA       NA      D</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h3>
<p>This example illustrated the following features of <code>twig</code>
* Decision tree * Multiple decisions * Multiple sequential events *
probability dependency on prior events * transition rewards * using
sequential computations * ICER</p>
<p>In addition, various intermediate objects and computations can be
returned by enabling <code>verbose</code>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://www.dashlab.ca" class="external-link">Hawre Jalal</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
